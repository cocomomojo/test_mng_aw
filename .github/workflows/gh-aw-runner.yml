name: make issue and test case from pr diff
# このワークフローはPR作成/更新時にgh-awをキャッシュ付きで実行します。

on:
  pull_request:
    types: [opened, edited, synchronize]
# PRの新規作成・更新・同期時に起動する設定です。

permissions:
  actions: read
  contents: read
  issues: write
  pull-requests: read
# GitHubトークンに必要な権限を明示しています。

jobs:
  run-agentic:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
# gh-awが差分だけでなく完全な履歴を使えるように全履歴を取得しておきます。

      # gh-aw はローカルで manual にコンパイルして `lock.yml` を push する運用のため
      # runner 側では gh/gh-aw のインストールや認証処理を行わず最小化します。

      - name: Using precompiled lock.yml
        run: |
          echo "Using precompiled .github/workflows/lock.yml (no local compile)."
          if [ -f .github/workflows/lock.yml ]; then
            echo "lock.yml present:" && ls -l .github/workflows/lock.yml
          else
            echo "WARNING: .github/workflows/lock.yml not found. Ensure you compiled and pushed it locally before opening/updating the PR."
            exit 0
          fi